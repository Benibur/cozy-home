// Generated by CoffeeScript 1.9.0
var CozyInstance, cozydb;

cozydb = require('cozydb');

CozyInstance = require('../models/cozyinstance');

module.exports = {
  message: function(req, res, next) {
    return CozyInstance.first(function(err, instance) {
      var body, data, domain, infos, locale;
      locale = instance.locale, domain = instance.domain;
      body = req.body;
      infos = {
        locale: locale,
        domain: domain
      };
      data = {
        to: "frank@cozycloud.cc",
        subject: "Demande d'assistance depuis un Cozy",
        content: (JSON.stringify(infos)) + "\n\n" + body.messageText
      };
      return cozydb.sendMailFromUser(data, (function(_this) {
        return function(err) {
          if (err) {
            return next(err);
          }
          return res.send({
            success: 'Mail successully sent to support.'
          });
        };
      })(this));
    });
  }
};
